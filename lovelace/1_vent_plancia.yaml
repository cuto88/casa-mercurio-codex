views:
  - title: Finestre (Vent estiva)
    path: vent
    icon: mdi:window-open-variant
    type: sections
    max_columns: 3   # 3 colonne fisse su desktop; stesso ordine su mobile

    sections:

      # ===== Colonna 1 â€” CONSIGLIO + CHECKLIST ===============================
      - type: grid
        cards:

          # Consiglio sintetico (ON = apri, OFF = chiudi)
          - type: conditional
            conditions:
              - entity: binary_sensor.vent_freecooling_calcolato
                state: "on"
            card:
              type: markdown
              content: |
                ## âœ… Apri le finestre adesso
                *Fuori Ã¨ piÃ¹ fresco **e** piÃ¹ secco â†’ raffreschi e deumidifichi gratis.*

          - type: conditional
            conditions:
              - entity: binary_sensor.vent_freecooling_calcolato
                state: "off"
            card:
              type: markdown
              content: |
                ## ðŸ›‘ Tieni le finestre chiuse
                *In questo momento non conviene scambiare aria con l'esterno.*

          # Checklist LIVE con icone verdi/rosse (nessuna custom-card, solo markdown templato)
          - type: markdown
            title: Criteri per "Apri finestre"
            content: >
              {% set Ti  = states('sensor.temperatura_interna_media')|float(0) %}
              {% set To  = states('sensor.temperatura_esterna')|float(0) %}
              {% set Ai  = states('sensor.ah_interna')|float(0) %}
              {% set Ao  = states('sensor.ah_esterna')|float(0) %}
              {% set dT  = (Ti - To)|round(1) %}
              {% set dAH = (Ai - Ao)|round(1) %}
              {# Soglie usate anche dalla VMC: puoi regolarle da UI #}
              {% set T_on  = states('input_number.vmc_fc_t_in_on')|float(24) %}
              {% set ToMin = states('input_number.vmc_fc_t_out_min')|float(20) %}

              Si consiglia di **aprire** quando:

              - {% if Ti > T_on %}âœ…{% else %}âŒ{% endif %} **Ti > {{ T_on|round(1) }} Â°C**
                *(attuale: **{{ Ti|round(1) }} Â°C**)*
              - {% if To < Ti %}âœ…{% else %}âŒ{% endif %} **To < Ti** *(Î”T = **{{ dT }} Â°C**)*
              - {% if To > ToMin %}âœ…{% else %}âŒ{% endif %} **To > {{ ToMin|round(1) }} Â°C**
                *(attuale: **{{ To|round(1) }} Â°C**)*
              - {% if dAH > 0 %}âœ…{% else %}âŒ{% endif %} **Î”AH = Ai âˆ’ Ao > 0 g/mÂ³**
                *(Ai **{{ Ai|round(1) }}**, Ao **{{ Ao|round(1) }}**, Î”AH **{{ dAH }} g/mÂ³**)*

              **Esito:** {% if Ti > T_on and To < Ti and To > ToMin and dAH > 0 %}
              âœ… *Apri le finestre*
              {% else %}
              ðŸ›‘ *Tieni chiuse*
              {% endif %}

          # Indicatore visivo dei due driver principali (Î”T e Î”AH)
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.deltat_in_out
                name: Î”T (Ti âˆ’ To)
                min: -15
                max: 15
                severity:
                  green: -15   # verde se fuori Ã¨ piÃ¹ freddo (Î”T negativo forte)
                  yellow: 0
                  red: 5
              - type: gauge
                entity: sensor.deltaah_in_out
                name: Î”AH (Ai âˆ’ Ao)
                min: -10
                max: 10
                severity:
                  green: 0     # verde se Î”AH > 0 â†’ fuori piÃ¹ secco
                  yellow: -1
                  red: -5

      # ===== Colonna 2 â€” PARAMETRI ORDINATI =================================
      - type: grid
        cards:

          - type: entities
            title: Temperature
            show_header_toggle: false
            entities:
              - entity: sensor.temperatura_interna_media
                name: T interna (Ti)
              - entity: sensor.temperatura_esterna
                name: T esterna (To)
              - entity: sensor.deltat_in_out
                name: Î”T = Ti âˆ’ To

          - type: entities
            title: UmiditÃ  assoluta (g/mÂ³)
            show_header_toggle: false
            entities:
              - entity: sensor.ah_interna
                name: AH interna (Ai)
              - entity: sensor.ah_esterna
                name: AH esterna (Ao)
              - entity: sensor.deltaah_in_out
                name: Î”AH = Ai âˆ’ Ao

          - type: entities
            title: UmiditÃ  relativa & Dew point
            show_header_toggle: false
            entities:
              - entity: sensor.umidita_interna_media
                name: UR interna
              - entity: sensor.umidita_esterna
                name: UR esterna
              - entity: sensor.dewpoint_interno
                name: Dew point interno

      # ===== Colonna 3 â€” SENSOR CARD "TEMPERATURE" + TREND ===================
      - type: grid
        cards:

          # SEZIONE "Sensor card" come nello screenshot
          - type: sensor
            entity: sensor.temperatura_interna_media
            name: T interna (media)
            graph: line
            detail: 2
            hours_to_show: 24

          - type: sensor
            entity: sensor.temperatura_giorno
            name: Zona giorno
            graph: line
            detail: 2
            hours_to_show: 24

          - type: sensor
            entity: sensor.temperatura_notte1
            name: Zona notte
            graph: line
            detail: 2
            hours_to_show: 24

          - type: sensor
            entity: sensor.temperatura_bagno
            name: Bagno
            graph: line
            detail: 2
            hours_to_show: 24

          - type: sensor
            entity: sensor.temperatura_esterna
            name: T esterna
            graph: line
            detail: 2
            hours_to_show: 24

          - type: sensor
            entity: sensor.dewpoint_interno
            name: Dew point interno
            graph: line
            detail: 2
            hours_to_show: 24
